# Example Configuration - Copy to config.yaml and customize
database:
  host: localhost
  port: 3306
  name: magento
  user: magento_user
  password: ${DB_PASSWORD}  # Use environment variable or replace with actual password
  
monitor:
  interval: 2m  # How often to check for stuck crons
  
  detection:
    # Global default thresholds
    max_running_time: 30m       # Alert if job runs longer than this
    max_pending_count: 20       # Alert if more than this many pending jobs
    consecutive_errors: 3       # Alert after this many consecutive errors
    max_missed_count: 5         # Alert if job missed this many times in lookback window
    lookback_window: 1h         # How far back to query cron_schedule
    threshold_checks: 2         # Number of consecutive detections before alerting (reduces false positives)
    
    # Scheduler health detection (monitors if php bin/magento cron:run is actually running)
    scheduler_inactivity_minutes: 10  # Alert if no jobs created in this many minutes
    scheduler_lookahead_minutes: 15   # AND no pending jobs scheduled in next X minutes
    
  # Per-group configuration overrides (optional)
  cron_groups:
    - name: index
      check_interval: 5m        # Optional: Override check frequency for this group
      max_running_time: 60m     # Index jobs can run longer
      max_pending_count: 10
      threshold_checks: 3
      
    - name: default
      check_interval: 10m
      consecutive_errors: 5     # Default group more tolerant of errors
      
    - name: consumers
      max_running_time: 15m     # Consumers should be fast
      max_pending_count: 30
      
  # Per-job configuration overrides (optional, highest priority)
  # Use this to set specific thresholds for individual problematic jobs
  job_overrides:
    # Example: Allow a specific reindex job to run much longer
    - job_code: indexer_reindex_all_invalid
      max_running_time: 180m    # 3 hours
      threshold_checks: 3
      
    # Example: Tolerate more errors for a flaky job
    - job_code: catalog_product_alert
      consecutive_errors: 10
      max_pending_count: 50
      
    # Example: Monitor a critical job more strictly
    # - job_code: ddg_automation_importer
    #   max_running_time: 30m
    #   consecutive_errors: 2
    #   threshold_checks: 1
      
logging:
  file: /var/log/magento-cron-monitor.log
  level: info  # debug, info, warn, error
  format: json # json or text
